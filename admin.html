
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de Pagamentos</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border: 1px solid #ccc; }
        th { background-color: #2196f3; color: white; }
        button { padding: 6px 12px; margin: 2px; }
    </style>
</head>
<body>
    <h2>Painel de Pagamentos</h2>
    <button onclick="mostrarPagamentos()">Pagamentos</button>
    <button onclick="mostrarUsuarios()">Usuários Ativos</button>
    <div id="usuariosDiv" style="display:none;">
        <select id="filtroUsuarios" onchange="carregarUsuarios()">
            <option value="todos">Todos</option>
            <option value="ativos">Ativos</option>
            <option value="inativos">Inativos</option>
        </select>
        <table id="usuariosTable">
            <thead>
                <tr>
                    <th>Usuário</th>
                    <th>Nome</th>
                    <th>Telefone</th>
                    <th>Senha</th>
                    <th>Expiração</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="usuariosBody"></tbody>
        </table>
    </div>
    <div id="pagamentosDiv">
        <table id="pagamentosTable">
            <thead>
                <tr>
                    <th>Usuário</th>
                    <th>ID</th>
                    <th>Valor (R$)</th>
                    <th>Status</th>
                    <th>Data</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="pagamentosBody"></tbody>
        </table>
    </div>

<script>
const SUPABASE_URL = "https://vgsinjzkuivzecmjhflq.supabase.co";
const SUPABASE_KEY = "public-anon-key"; // substitua pelo seu se necessário

async function carregarUsuarios() {
    const filtro = document.getElementById("filtroUsuarios").value;
    const res = await fetch(`${SUPABASE_URL}/rest/v1/usuarios?select=*`, {
        headers: {
            apikey: SUPABASE_KEY,
            Authorization: `Bearer ${SUPABASE_KEY}`
        }
    });
    const data = await res.json();
    const corpo = document.getElementById("usuariosBody");
    corpo.innerHTML = "";
    data.forEach(u => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${u.usuario}</td>
            <td>${u.nome}</td>
            <td>${u.telefone}</td>
            <td>${u.senha}</td>
            <td>${new Date(u.data_expira).toLocaleDateString()}</td>
            <td>
                <button onclick="editarUsuario('${u.id}', '${u.usuario}', '${u.nome}', '${u.telefone}', '${u.senha}', '${u.data_expira}')">Editar</button>
                <button onclick="excluirUsuario('${u.id}')">Excluir</button>
            </td>`;
        corpo.appendChild(tr);
    });
}

async function excluirUsuario(id) {
    if (!confirm("Tem certeza que deseja excluir este usuário?")) return;
    await fetch(`${SUPABASE_URL}/rest/v1/usuarios?id=eq.${id}`, {
        method: "DELETE",
        headers: {
            apikey: SUPABASE_KEY,
            Authorization: `Bearer ${SUPABASE_KEY}`
        }
    });
    carregarUsuarios();
}

function editarUsuario(id, usuario, nome, telefone, senha, data) {
    const novoNome = prompt("Novo nome:", nome);
    const novoTel = prompt("Novo telefone:", telefone);
    const novaSenha = prompt("Nova senha:", senha);
    const novaData = prompt("Nova data (YYYY-MM-DD):", data.split("T")[0]);
    fetch(`${SUPABASE_URL}/rest/v1/usuarios?id=eq.${id}`, {
        method: "PATCH",
        headers: {
            apikey: SUPABASE_KEY,
            Authorization: `Bearer ${SUPABASE_KEY}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            nome: novoNome,
            telefone: novoTel,
            senha: novaSenha,
            data_expira: novaData
        })
    }).then(() => carregarUsuarios());
}

function mostrarUsuarios() {
    document.getElementById("usuariosDiv").style.display = "block";
    document.getElementById("pagamentosDiv").style.display = "none";
    carregarUsuarios();
}

function mostrarPagamentos() {
    document.getElementById("usuariosDiv").style.display = "none";
    document.getElementById("pagamentosDiv").style.display = "block";
}
</script>
</body>
</html>
